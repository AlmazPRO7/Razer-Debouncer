# BW3‑Debounce  
Программный «анти‑дребезг» и фильтр ложных повторов для **Razer Black Widow V3 Mini / другие USB‑клавиатуры** под Windows 10‑11.  
Работает на уровне системного *Low‑Level Hook* (`WH_KEYBOARD_LL`), **блокирует**:

* аппаратный дребезг контактов (5 – 50 мс)  
* «фантомные» нажатия контроллера (60 – 120 мс)  
* авто‑повтор без события `UP`

При этом удержание клавиши по‑прежнему даёт нормальный системный авто‑повтор (задержка ≥ 250 мс).

---

## Фичи
| ✔            | Детали |
|--------------|--------|
| **Порог по‑умолчанию 100 мс** | можно изменить флагом `--ms` |
| **Адаптивный per‑key debounce** | порог растёт, если дребезг продолжается |
| **Фильтр “DOWN без UP”** | сразу блокирует «залипающие» повторы |
| **Калибратор в системном трее** | медиана 20 нажатий записывается в JSON |
| **Лог‑файл с ротацией** | `%APPDATA%\bw3_chatter.log` |
| **Запуск one‑file EXE** | собирается PyInstaller (`--onefile --noconsole`) |
| **Автозапуск через реестр** | автоматически при первом старте (отключаем `--no-startup`) |
| **Совместимо с Python 3.11+ x64** | без C‑расширений, только ctypes |

---

## Быстрая установка (Windows 10 / 11 ×64)

```powershell
# 1. Python 3.11+ x64 (обязательно «Add Python to PATH»)
# 2. С клонированного/скачанного репо:
cd BW3-Debounce
pip install -r requirements.txt      # pystray pillow keyboard
python bw3_debounce.py --debug       # первый тест

Заметите в консоли

Hook ID = 12345678
Started message loop…
DOWN  48 Δ95.0 ms
BLOCK_BOUNCE 48 Δ12.3 ms
Если видите строки DOWN/BLOCK_… — фильтр работает.
Закройте окно PowerShell → скрипт останется в трее (иконка «⌨»).

## Запуск без PowerShell (EXE)

powershell
Копировать
pip install pyinstaller
pyinstaller --onefile --noconsole bw3_debounce.py
dist\bw3_debounce.exe — двойной клик, появится UAC‑запрос.

Файл автоматически добавится в автозапуск (HKCU…\Run).
Отключить: bw3_debounce.exe --no-startup.

## Использование / калибровка

Действие	Как сделать
Включить/выключить фильтр	ПКМ по иконке «⌨» → Вкл/Выкл
Открыть лог	ПКМ → Открыть лог
Калибровать конкретную клавишу	ПКМ → Калибровать… → быстро нажать проблемную клавишу ~20 раз → Esc
Изменить базовый порог	bw3_debounce.py --ms 120
Запустить с выводом в консоль	--debug

## Параметры командной строки

Флаг	Значение по умолчанию	Назначение
--ms <int>	100	базовое окно (мс)
--debug	выключен	печать событий в консоль
--no-startup	выключен	не добавлять в автозапуск

## FAQ / Траблшутинг

Вопрос / проблема	Решение
Hook ID = 0	Скрипт не под админом → «Запуск от имени администратора».
OverflowError: int too long	Вы запускаете старую версию Python 3.11+? Обновите скрипт ≥ v3.7 (правильные argtypes).
Антивирус ругается	Добавьте EXE в исключения (используется глобальный клавиатурный hook).
Игровой анти‑чит	В трее «Вкл/Выкл» → выключите фильтр перед запуском соревновательной игры.
Клавиша всё ещё дублирует	Увеличьте --ms до 120‑130 мс или откройте калибратор.

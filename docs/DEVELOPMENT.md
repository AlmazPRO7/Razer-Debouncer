# Руководство разработчика (Development Guide)

Этот документ описывает настройку окружения, локальный запуск и сборку проекта.

## 1. Предварительные требования
- Windows 10/11.
- Python 3.11 (рекомендуется).
- Git (по желанию, для управления версиями).
- Доступ к PowerShell.

## 2. Клонирование и структура
Ожидаемая структура (фактические файлы могут отличаться и будут уточняться):

```
Razer_Deboounce/
├─ bw3_debounce.py
├─ bw3_debounce2.py
├─ bw3_debounce3.py
├─ bw3_debounce.spec        # Конфиг PyInstaller
├─ build/                   # Артефакты сборки (автогенерация)
├─ dist/                    # Готовые сборки (автогенерация)
└─ docs/                    # Документация
```

## 3. Настройка окружения
В PowerShell из корня проекта:

```
py -3 -m venv .venv
. .venv\Scripts\Activate.ps1
python -m pip install --upgrade pip
```

### Зависимости
Runtime:
```
pip install -r requirements.txt
```
Dev/тесты/линтинг:
```
pip install -r requirements-dev.txt
```

## 4. Локальный запуск
Запустите актуальный скрипт напрямую (пример для `bw3_debounce3.py`):

```
python bw3_debounce3.py
```

Если скрипту нужны повышенные привилегии (доступ к устройствам/драйверам), запускайте PowerShell «От имени администратора».

Ключевые флаги:
- `--selftest` — самотест без WinAPI/GUI (WSL/pytest).
- `--allow-multiple` — отключает проверку «единственный экземпляр» (отладка).
- `--no-chord-bypass` — возвращает «мягкий» пост‑UP фильтр в аккордах.

## 5. Сборка (PyInstaller)
Сборка с использованием готового `.spec`:

```
pyinstaller bw3_debounce.spec
```

Готовые артефакты появятся в `dist/`. Папка `build/` содержит промежуточные файлы.

Полезные флаги:
- `--onefile` — упаковать в один исполняемый файл.
- `--noconsole` — отключить консольное окно для GUI-приложений.

(Если флаги уже заданы в `.spec`, их дублировать не нужно.)

## 6. Качество кода (опционально)
Рекомендуемые инструменты (добавьте при необходимости):
- `black` — автоформатирование
- `isort` — сортировка импортов
- `ruff` или `flake8` — статический анализ

Пример установки:
```
pip install black isort ruff
```

## 7. Отладка и логирование
- Добавляйте понятные сообщения об ошибках и минимальное логирование.
- Для проблем с доступом к устройствам проверяйте запуск с правами администратора.
- Лог: `%APPDATA%/bw3_chatter.log`.
- Вспомогательные скрипты:
  - `scripts/tail_log.sh` — «хвост» лога в WSL (`tail -f`).
  - `python3 scripts/analyze_log.py` — сводка `BLOCK_*` событий и топ проблемных клавиш.

## 8. Выпуск версий
- Ведите `docs/CHANGELOG.md`.
- Используйте теги Git (например, `v1.2.0`).
### Работа через WSL
Если редактируете из WSL, используйте обёртки для делегирования выполнения в Windows:

```
# установка зависимостей (Windows venv)
./scripts/run_admin_from_wsl.sh --setup

# запуск (передаем параметры после `--`)
./scripts/run_admin_from_wsl.sh -- --debug --no-startup

# сборка (PyInstaller)
./scripts/run_admin_from_wsl.sh --build
```

## 9. Документация (локальные проверки)
- Проверка упоминаний ключевых флагов и скриптов в документации:
```
python3 scripts/docs_check.py
```
- Обновляйте `README.md`, `docs/*` при добавлении CLI‑флагов/скриптов/процессов.
